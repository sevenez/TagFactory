## 概述

这是一个非常典型的**用户画像（User Profile）与数据仓库（Data Warehouse）**结合的系统设计需求。

基于你提供的三张核心维度表（用户、商家、商品-电子产品类），我们要构建一个“标签工厂”。标签工厂的核心在于**“数据的标签化”**，即将原始数据转化为业务可理解、可使用的符号。

以下是为您设计的《电商标签工厂管理系统》方案，包含**标签体系设计**、**数据库模型设计**以及**计算逻辑**。

------



### 一、 标签体系设计架构



我们需要针对三大主体（用户、商家、商品）分别设计四层标签。由于你的商品主要是“电子产品”，我们的标签会针对该行业进行垂直优化。



#### 1. 用户画像标签体系 (User Tags)



*目标：精准营销、个性化推荐、用户分层。*

| **标签层级**               | **定义**                                         | **典型标签示例 (Key-Value)**                                 | **数据来源/计算逻辑**                                        |
| -------------------------- | ------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **基础标签** (Basic)       | 事实类数据，直接从数据库字段映射。               | **性别**: 男/女 **年龄段**: 95后/00后 **常驻地**: 北京 **会员等级**: 普通/VIP | `customer_info` 表直接映射。 例如：`age` > 25 -> "25岁+"     |
| **行为标签** (Behavior)    | 用户的短期/实时行为记录。 *(注：需结合日志数据)* | **最近浏览**: iPhone 15 **加购未买**: 蓝牙耳机 **活跃时段**: 深夜党(22:00-02:00) **搜索词**: "降噪" | 埋点日志、搜索记录。 映射逻辑：最近3天有登录 = "活跃用户"    |
| **统计标签** (Statistical) | 基于历史数据的累计统计。                         | **累计消费**: 5000元+ **消费频次**: 低频/高频 **客单价**: 高(>5000) **退货率**: 极低 | `customer_info` (total_consume) 或订单流水聚合。 例如：`total_consume` / `consume_months` |
| **衍生标签** (Derived)     | 需结合模型、规则或算法生成的预测性标签。         | **品牌偏好**: 果粉/华为死忠 **价格敏感度**: 高/中/低 **RFM分层**: 重要价值用户 **换机预测**: 近期有换机需求 | **算法模型**： 购买全是Apple产品 -> "果粉" 只买打折品 -> "价格敏感度高" |



#### 2. 商品标签体系 (Product Tags - 电子产品专版)



*目标：选品优化、关联推荐、库存管理。*

| **标签层级** | **定义**               | **典型标签示例**                                             | **数据来源/计算逻辑**                                        |
| ------------ | ---------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **基础标签** | 商品固有属性。         | **品类**: 手机 **品牌**: 小米 **规格**: 512G大内存 **产地**: 中国 | `product_info` 表直接映射。 解析 `spec_params` JSON 提取 "512G" |
| **行为标签** | 用户对商品的互动行为。 | **热搜商品**: 是 **高被看商品**: 是 **常被加入收藏**: 是     | 关联用户行为日志。 点击量 Top 100 -> "热搜"                  |
| **统计标签** | 销售表现数据。         | **畅销款**: 月销1000+ **滞销款**: 库存周转慢 **高退货款**: 退货率>5% | `product_info` (`monthly_sales`, `stock_quantity`)。 销量高且库存低 -> "紧俏" |
| **衍生标签** | 商品的抽象属性。       | **性价比**: 高/低 **新品趋势**: 潜力爆款 **人群定位**: 商务/电竞/学生 | **规则计算**： 价格低+配置高 -> "高性价比" 分类为"显卡"+高价 -> "电竞" |



#### 3. 商家标签体系 (Seller Tags)



*目标：商家治理、供应链金融、平台流量分配。*

| **标签层级** | **定义**       | **典型标签示例**                                             | **数据来源/计算逻辑**                                        |
| ------------ | -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **基础标签** | 商家基本资质。 | **经营模式**: 自营/第三方 **地域**: 江浙沪包邮区 **成立年限**: 老店(5年+) | `seller_info` 表直接映射。 `is_self_operated`=1 -> "自营"    |
| **行为标签** | 商家运营行为。 | **上新频率**: 周更/月更 **响应速度**: 秒回/慢                | 客服日志、商品发布日志。 发货时间 < 12h -> "极速发货"        |
| **统计标签** | 经营数据统计。 | **信用分**: 极好 **好评率**: 高(>98%) **月销售额**: 百万级   | `seller_info` (`seller_rating`, `praise_rate`)。             |
| **衍生标签** | 综合评级。     | **主要潜力**: 潜力股 **风险等级**: 高风险 **主营类目**: 数码专营 | **风控模型**： 好评率低 + 投诉多 -> "高风险" 销量增长快 -> "潜力股" |

------



### 二、 标签系统数据库设计 (SQL Schema)



为了实现“标签工厂”，不能仅仅依赖原有的业务表，需要建立独立的**标签元数据表**和**标签关系表**。

建议新建 `tag_system` 数据库或在 `tagfactory` 中添加以下表：



#### 1. 标签定义表 (Tag Definitions)



管理所有的标签元数据，定义“有哪些标签”。

```sql
CREATE TABLE `tag_definition` (
  `tag_id` INT AUTO_INCREMENT PRIMARY KEY COMMENT '标签ID',
  `tag_code` VARCHAR(50) NOT NULL UNIQUE COMMENT '标签编码（如 USER_GENDER, PROD_HOT）',
  `tag_name` VARCHAR(50) NOT NULL COMMENT '标签显示名（如 性别, 热销商品）',
  `tag_layer` ENUM('基础', '行为', '统计', '衍生') NOT NULL COMMENT '标签层级',
  `entity_type` ENUM('CUSTOMER', 'PRODUCT', 'SELLER') NOT NULL COMMENT '标签归属实体',
  `data_type` ENUM('ENUM', 'BOOLEAN', 'NUMBER', 'STRING') DEFAULT 'STRING' COMMENT '值类型',
  `update_frequency` ENUM('REALTIME', 'DAILY', 'WEEKLY', 'MONTHLY') DEFAULT 'DAILY' COMMENT '更新频率',
  `status` TINYINT(1) DEFAULT 1 COMMENT '状态（1-启用 0-停用）',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP
) COMMENT='标签定义元数据表';
```



#### 2. 用户标签宽表 (Customer Tag Relation)



存储用户身上的标签结果。**注意：** 为了查询性能，通常会设计为“宽表”（列式存储思想）或者“纵表”（E-A-V模型）。这里推荐**纵表**设计，适合MySQL扩展。

```sql
CREATE TABLE `tag_relation_customer` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `customer_id` CHAR(17) NOT NULL COMMENT '关联 customer_info.customer_id',
  `tag_code` VARCHAR(50) NOT NULL COMMENT '关联 tag_definition.tag_code',
  `tag_value` VARCHAR(255) NOT NULL COMMENT '标签值（如 "男", "高价值", "0.85"）',
  `score` DECIMAL(5,4) DEFAULT 1.0 COMMENT '标签权重/置信度（用于算法标签）',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  -- 联合索引保证一个用户对一个标签只有一个值
  UNIQUE KEY `uk_cust_tag` (`customer_id`, `tag_code`), 
  INDEX `idx_tag_value` (`tag_code`, `tag_value`) -- 便于筛选：找所有"高价值"用户
) COMMENT='用户标签结果表';
```

*(注：商品和商家的标签关系表结构类似，只需将 `customer_id` 替换为 `product_id` 或 `seller_id`)*

------



### 三、 标签工厂计算逻辑与实现



你需要通过 SQL 脚本或代码逻辑将原始数据转化为 `tag_relation` 表中的数据。



#### 1. 基础标签计算 (SQL ETL)



*场景：每天凌晨运行一次，同步基本信息。*

**示例逻辑：为用户打上“省份”标签**

```sql
INSERT INTO tag_relation_customer (customer_id, tag_code, tag_value)
SELECT 
    customer_id, 
    'USER_PROVINCE', 
    province 
FROM customer_info
WHERE province IS NOT NULL
ON DUPLICATE KEY UPDATE tag_value = VALUES(tag_value);
```



#### 2. 统计标签计算 (Aggregation)



*场景：利用聚合函数计算。*

**示例逻辑：为商品打上“库存状态”标签（基于你的 `stock_quantity`）**

```sql
INSERT INTO tag_relation_product (product_id, tag_code, tag_value)
SELECT 
    product_id,
    'PROD_STOCK_LEVEL',
    CASE 
        WHEN stock_quantity = 0 THEN '无货'
        WHEN stock_quantity < 10 THEN '紧张'
        ELSE '充足'
    END
FROM product_info
ON DUPLICATE KEY UPDATE tag_value = VALUES(tag_value);
```



#### 3. 衍生标签计算 (Rule Engine / Complex SQL)



*场景：根据业务规则组合判断。*

示例逻辑：识别“高价值数码用户”

规则：总消费 > 10000 且 学历为 本科及以上

```sql
INSERT INTO tag_relation_customer (customer_id, tag_code, tag_value)
SELECT 
    customer_id,
    'USER_HIGH_VALUE_DIGITAL',
    'TRUE'
FROM customer_info
WHERE total_consume > 10000 
  AND education IN ('本科', '硕士', '博士')
ON DUPLICATE KEY UPDATE tag_value = VALUES(tag_value);
```

------



### 四、 电子产品行业的特殊建议



针对你的 `product_info` 表（电子产品类），建议增加以下几个具体的**衍生标签**，这将对系统价值提升巨大：

1. **生命周期标签 (Product Lifecycle):**
   - 逻辑：利用 `create_time`。
   - 值：`新品` (上架<30天), `当季品` (上架30-180天), `长尾品` (>180天)。
   - 用途：新品给流量扶持，长尾品做清仓促销。
2. **价格带标签 (Price Band):**
   - 逻辑：根据 `category` 和 `price` 动态计算。
   - 值：对于手机，<1000为`低端`, 1000-4000为`中端`, >4000为`旗舰`。
   - 用途：匹配用户的消费能力。
3. **折扣敏感度 (Discount Sensitivity):**
   - 逻辑：`original_price` - `price` 的差额 或 `discount_rate`。
   - 值：`五折区`, `微降价`, `保值品`。
   - 用途：推送给喜欢薅羊毛的用户。

---

## 标签设计

基于您提供的数据库 Schema（顾客、商家、商品-电子产品），我们需要构建一个覆盖全生命周期的标签字典。由于您的商品表针对“电子产品”进行了优化（包含 `spec_params` JSON配置），标签设计将特别体现**数码行业**的垂直特性。

以下是为您详细设计的**全量标签字典**，分为三大主体进行规划。

------



### 一、 顾客画像标签 (Customer Tags)



**核心逻辑：** 基于 `customer_info` 表，结合 RFM 模型（Recency, Frequency, Monetary）思想设计。



#### 1. 基础标签 (Basic)



*直接描述用户自然属性*

| **标签名称** | **标签编码**    | **标签值示例/逻辑定义**                          | **源字段**                      |
| ------------ | --------------- | ------------------------------------------------ | ------------------------------- |
| **性别识别** | `C_BAS_GENDER`  | 男 / 女 / 未知                                   | `gender`                        |
| **年龄段**   | `C_BAS_AGE_BIN` | Z世代(<=24), 青年(25-35), 中年(36-50), 银发(>50) | `age`                           |
| **学历水平** | `C_BAS_EDU`     | 高知人群(本科及以上) / 基础人群                  | `education`                     |
| **地域分布** | `C_BAS_REGION`  | 一线城市(北上广深) / 江浙沪 / 其他               | `province` (需结合城市字典映射) |
| **入会时长** | `C_BAS_TENURE`  | 新注册(<7天) / 月度新人 / 老用户(>1年)           | `register_time`                 |



#### 2. 行为标签 (Behavior)



*基于用户活跃度的动态快照*

| **标签名称** | **标签编码**     | **标签值示例/逻辑定义**                           | **源字段**                 |
| ------------ | ---------------- | ------------------------------------------------- | -------------------------- |
| **活跃状态** | `C_BEH_ACTIVE`   | 活跃(近7天登录) / 沉睡(30-90天未动) / 流失(>90天) | `last_active_time`         |
| **注册时段** | `C_BEH_REG_TIME` | 夜猫子(22:00-04:00) / 上班摸鱼党(10:00-17:00)     | `register_time` (提取小时) |



#### 3. 统计标签 (Statistical)



*基于消费数据的累计统计*

| **标签名称**   | **标签编码**     | **标签值示例/逻辑定义**          | **源字段**                         |
| -------------- | ---------------- | -------------------------------- | ---------------------------------- |
| **消费能力**   | `C_STA_MONETARY` | 高消费(>1w) / 中消费 / 低消费    | `total_consume`                    |
| **购买频次**   | `C_STA_FREQ`     | 单次客 / 复购客(>1) / 忠诚客(>5) | `consume_months`                   |
| **客单价等级** | `C_STA_ATV`      | 高净值(均单价>3000) / 价格敏感   | `total_consume` / `consume_months` |



#### 4. 衍生标签 (Derived)



*通过规则或算法推算的抽象标签*

| **标签名称**      | **标签编码** | **标签值示例/逻辑定义**                                      | **计算逻辑**                                  |
| ----------------- | ------------ | ------------------------------------------------------------ | --------------------------------------------- |
| **用户价值(RFM)** | `C_DRV_RFM`  | **重要价值用户** (高频高消近期活跃) **潜力用户** (低频高消)  | 综合 R(last_active), F(months), M(total)      |
| **数码偏好**      | `C_DRV_PREF` | **极客** (男+35岁以下+高消费) **家庭用户** (女+30岁以上+购买家电类) | 组合 `gender`, `age`, `category` (需关联订单) |

------



### 二、 商品标签 (Product Tags) —— 电子产品专版



**核心逻辑：** 充分利用 `spec_params` (JSON) 解析详细参数，并结合 `price` 和 `status` 做精细化运营。



#### 1. 基础标签 (Basic)



*商品固有属性*

| **标签名称**  | **标签编码**       | **标签值示例/逻辑定义**                      | **源字段**                      |
| ------------- | ------------------ | -------------------------------------------- | ------------------------------- |
| **所属品类**  | `P_BAS_CAT`        | 手机 / 平板 / 耳机...                        | `category`                      |
| **品牌阵营**  | `P_BAS_BRAND`      | 苹果 / 华为 / 小米 / 其它                    | `brand_name`                    |
| **硬件规格**  | `P_BAS_SPEC`       | **大内存**(>=512G) / **5G支持** / **高刷屏** | 解析 `spec_params` JSON         |
| **价格区间**  | `P_BAS_PRICE_TIER` | 百元机 / 千元机 / 旗舰机(>4000) / 奢华机     | `price`                         |
| **产地/保质** | `P_BAS_SOURCE`     | 国产 / 进口 / 短保品                         | `production_date`, `brand_name` |



#### 2. 行为标签 (Behavior)



*基于市场反馈的动态表现*

| **标签名称** | **标签编码**  | **标签值示例/逻辑定义**                     | **源字段**              |
| ------------ | ------------- | ------------------------------------------- | ----------------------- |
| **库存预警** | `P_BEH_STOCK` | **紧缺**(<10件) / **积压**(>1000件且销量低) | `stock_quantity`        |
| **销售热度** | `P_BEH_HEAT`  | **爆款**(月销>1000) / **冷门**              | `monthly_sales`         |
| **发货时效** | `P_BEH_SPEED` | 次日达 / 预售需等待                         | `stock_status` = '预售' |



#### 3. 统计标签 (Statistical)



*基于数值计算的指标*

| **标签名称** | **标签编码**     | **标签值示例/逻辑定义**          | **源字段**                                  |
| ------------ | ---------------- | -------------------------------- | ------------------------------------------- |
| **折扣力度** | `P_STA_DISCOUNT` | 原价卖 / **骨折价**(<8折) / 微降 | `discount_rate` 或 `price`/`original_price` |
| **转化能力** | `P_STA_CONV`     | **高转化** (购买人数/浏览人数)   | `buy_customer_count` (需结合浏览埋点)       |
| **物流属性** | `P_STA_LOGISTIC` | 大件商品 / 轻小件                | `product_weight`, `product_volume`          |



#### 4. 衍生标签 (Derived)



*用于导购推荐的高级标签*

| **标签名称**   | **标签编码**      | **标签值示例/逻辑定义**                              | **计算逻辑**                             |
| -------------- | ----------------- | ---------------------------------------------------- | ---------------------------------------- |
| **生命周期**   | `P_DRV_LIFECYCLE` | **新品上市** (上架<30天) **当季热推** **清仓长尾**   | `create_time` 与当前时间差值             |
| **性价比指数** | `P_DRV_CP_RATIO`  | **超高性价比** (低价+高配) **品牌溢价** (高价+低配)  | 算法：硬件得分 / 价格                    |
| **人群定位**   | `P_DRV_TARGET`    | **商务风** (黑/灰+高价) **电竞风** (RGB/高刷+高性能) | 解析 `spec_params` + `product_name`      |
| **售后无忧**   | `P_DRV_SERVICE`   | 是 (包邮 + 7天退换 + 商家评分>4.8)                   | `is_free_shipping`, `after_sales_policy` |

------



### 三、 商家标签 (Seller Tags)



**核心逻辑：** 侧重于商家的**履约能力**和**信誉等级**，用于平台风控和流量分发。



#### 1. 基础标签 (Basic)



| **标签名称** | **标签编码** | **标签值示例/逻辑定义**      | **源字段**                        |
| ------------ | ------------ | ---------------------------- | --------------------------------- |
| **经营模式** | `S_BAS_MODE` | 平台自营 / 品牌旗舰 / 普通店 | `is_self_operated`, `seller_name` |
| **所在地区** | `S_BAS_CITY` | 江浙沪商家 / 珠三角商家      | `city`                            |
| **老字号**   | `S_BAS_AGE`  | 新店开张 / 5年老店           | `establish_time`                  |



#### 2. 统计/行为标签 (Statistical)



| **标签名称** | **标签编码**    | **标签值示例/逻辑定义**                         | **源字段**           |
| ------------ | --------------- | ----------------------------------------------- | -------------------- |
| **信誉评级** | `S_STA_CREDIT`  | **金牌商家**(评分>4.8) / **高危商家**(评分<3.5) | `seller_rating`      |
| **口碑表现** | `S_STA_PRAISE`  | 零差评 / 争议多                                 | `praise_rate`        |
| **资本实力** | `S_STA_CAPITAL` | 雄厚(>1000万) / 小微企业                        | `registered_capital` |

------



### 四、 关键技术实现：如何提取这些标签？



针对电子产品特有的 **JSON 规格参数 (`spec_params`)** 和 **衍生标签**，这里给出两个具体的 SQL 实现示例。



#### 1. 提取 JSON 中的规格生成标签 (MySQL 5.7+)



假设 spec_params 存的是 {"color": ["黑色"], "storage": "256G", "network": "5G"}。

我们需要给商品打上 "5G手机" 和 "大内存" 的标签。

```sql
-- 插入标签：网络制式
INSERT INTO tag_relation_product (product_id, tag_code, tag_value)
SELECT 
    product_id, 
    'P_BAS_SPEC_NET', 
    '5G'
FROM product_info
WHERE category = '手机' 
  AND JSON_UNQUOTE(JSON_EXTRACT(spec_params, '$.network')) LIKE '%5G%';

-- 插入标签：大内存 (假设 > 256G 算大内存)
INSERT INTO tag_relation_product (product_id, tag_code, tag_value)
SELECT 
    product_id, 
    'P_BAS_SPEC_STORAGE', 
    '大内存'
FROM product_info
WHERE category IN ('手机', '平板电脑')
  AND (
      JSON_UNQUOTE(JSON_EXTRACT(spec_params, '$.storage')) LIKE '%512G%' 
      OR 
      JSON_UNQUOTE(JSON_EXTRACT(spec_params, '$.storage')) LIKE '%1T%'
  );
```



#### 2. 生成“新品上市”衍生标签

```sql
INSERT INTO tag_relation_product (product_id, tag_code, tag_value)
SELECT 
    product_id, 
    'P_DRV_LIFECYCLE', 
    CASE 
        WHEN DATEDIFF(NOW(), create_time) <= 30 THEN '新品上市'
        WHEN DATEDIFF(NOW(), create_time) <= 90 THEN '次新热卖'
        ELSE '常态销售'
    END
FROM product_info
WHERE status = 1 -- 只针对上架商品
ON DUPLICATE KEY UPDATE tag_value = VALUES(tag_value);
```



### 五、 总结与建议



1. **优先实现基础和统计标签**：这类标签无需复杂算法，直接写 SQL 脚本即可完成初始化，能迅速支撑起前台的“筛选”和“排序”功能。
2. **JSON 解析是关键**：电子产品的核心差异在于配置，务必利用好 `product_info` 中的 `spec_params` 字段，这是你与其他通用电商系统的差异化竞争点。
3. **标签更新机制**：
   - **静态标签**（如性别、产地）：用户/商品注册或编辑时更新。
   - **动态标签**（如活跃状态、库存紧张）：需要 T+1（每天夜间）定时任务跑批更新。

需要我针对某个具体的标签（例如 RFM 用户分层）写出完整的计算 SQL 吗？