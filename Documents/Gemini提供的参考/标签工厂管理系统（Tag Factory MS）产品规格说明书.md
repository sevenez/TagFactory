这是一个为您量身定制的《标签工厂管理系统产品规格说明书（PRD）》。

这份文档基于**电子产品电商集团**的背景，结合了DMP（数据管理平台）和CDP（客户数据平台）的设计理念，涵盖了您要求的门店、商品、客户三大维度及四类标签层级。

---

# 标签工厂管理系统（Tag Factory MS）产品规格说明书

**版本号**：V1.0
**文档状态**：草稿
**撰写日期**：202X年X月X日
**面向用户**：数据分析师、运营人员、门店督导、采购经理

---

## 1. 项目背景与目标

### 1.1 项目背景
作为一家大型电子产品电商集团，我们拥有海量的门店（线下渠道）、商品（SKU/SPU）和客户（会员/散客）数据。目前数据分散在订单表、日志表和CRM中，缺乏统一的业务语义。业务部门无法直接利用数据进行精细化运营（如：筛选出“喜欢买苹果手机的高净值客户”或“库存周转慢的门店”）。

### 1.2 项目目标
搭建一套标准化的标签管理系统，实现：
1.  **数据资产化**：将原始数据转化为业务可理解的标签。
2.  **画像可视化**：输入ID即可获得360度全景画像。
3.  **运营精细化**：支持自定义规则圈选目标对象，赋能营销和决策。

---

## 2. 总体架构设计

### 2.1 核心实体对象
系统围绕三大核心实体构建：
1.  **客户（Customer）**：C端消费者。
2.  **商品（Product）**：电子产品SKU/SPU。
3.  **门店（Store）**：线下实体店或各级经销商。

### 2.2 标签体系分层（Tag Hierarchy）
所有实体的标签均遵循以下四层结构：
*   **L1 基础标签 (Basic)**：直接来源于属性表。
    *   *例：客户性别、手机号归属地；商品品牌、颜色；门店面积、所在城市。*
*   **L2 行为标签 (Behavior)**：基于时间序列的事件记录。
    *   *例：近7天浏览过笔记本电脑、加入购物车未支付、门店最近一次进货时间。*
*   **L3 统计标签 (Statistical)**：对行为数据的聚合计算（Sum/Avg/Count/Max）。
    *   *例：累积消费金额、近30天退货率、门店月均销售额、商品复购率。*
*   **L4 衍生标签 (Derived)**：基于算法模型或复杂规则生成的偏好/预测标签。
    *   *例：价格敏感度（高/中/低）、品牌忠诚度、甚至流失风险、门店潜力等级。*

---

## 3. 功能模块详解

### 3.1 模块一：全景画像查询 (ID Explorer)
**功能描述**：输入特定ID，展示该对象的全量标签信息，支持可视化呈现。

**功能要点**：
1.  **多维搜索入口**：
    *   支持切换搜索对象：客户ID/手机号、商品SKU编码、门店ID/名称。
2.  **画像仪表盘**：
    *   **头部信息卡**：展示关键基础信息（如：头像/Logo、等级、注册时间）。
    *   **标签云（Tag Cloud）**：高亮显示该对象最显著的特征（如：“果粉”、“高退货”、“旗舰店”）。
    *   **详情列表**：按标签层级分类展示所有关联标签及当前值。
3.  **轨迹/动态（Time-line）**：
    *   展示该ID最近的关键行为记录（如：客户最近一笔订单、商品最近一次调价、门店最近一次报修）。

**应用场景示例**：
> 客服接到投诉，输入客户ID，系统显示该客户为“高净值”、“价格敏感”、“近期有3次退货记录”，客服立即决定升级处理权限，进行安抚。

### 3.2 模块二：规则圈选引擎 (Rule Engine)
**功能描述**：用户通过可视化的方式组合标签逻辑，筛选出符合条件的门店、商品或客户列表。

**功能要点**：
1.  **规则创建器**：
    *   支持**且(AND)、或(OR)、非(NOT)** 逻辑组合。
    *   支持数值比较（>、<、=、区间）、文本包含、时间范围筛选。
    *   *交互示例*：[客户.基础.城市 = '上海'] AND [客户.统计.近30天消费 > 5000] AND [客户.衍生.偏好品牌 = '华为']。
2.  **预估与试算**：
    *   在保存规则前，点击“试算”，系统实时返回符合条件的记录数（Count），便于调整阈值。
3.  **结果操作**：
    *   **导出数据**：下载CSV/Excel，包含ID及选定的标签列。
    *   **保存为人群包/商品池**：保存规则，每日自动更新（动态人群）。
    *   **推送服务**：通过API推送到营销系统（发短信）或ERP（自动补货）。

**应用场景示例**：
> 采购经理需要筛选“库存周转天数>60天”且“单价>3000元”的“笔记本电脑”，进行降价促销处理。

### 3.3 模块三：标签元数据管理 (Tag Metadata)
**功能描述**：管理标签的生命周期，定义标签的计算口径。

**功能要点**：
1.  **标签列表**：查看所有已上线的标签，支持按实体、类型筛选。
2.  **标签详情定义**：
    *   **标签名称**：如“高价值客户”。
    *   **标签标识**：tag_customer_high_value (系统唯一字段)。
    *   **业务口径**：文字描述（如：年消费大于5万且退货率低于5%）。
    *   **更新频率**：T+1（日更）、Real-time（实时）、Monthly（月更）。
    *   **数据属主**：负责该标签准确性的部门。
3.  **上下线管理**：支持停用不再使用的标签，停用后规则圈选模块不可见。

### 3.4 模块四：原始数据透视 (Data Catalog)
**功能描述**：即您要求的“查看全部原始数据表（不可编辑）”，主要用于数据溯源和核对。

**功能要点**：
1.  **数据表目录**：
    *   按数仓分层（ODS/DWD/DWS）展示表结构。
    *   支持搜索表名（如：`ods_order_info`）或字段名（如：`payment_amount`）。
2.  **数据预览（Sample Data）**：
    *   点击数据表，展示前50条数据样例（Masking脱敏处理，如手机号中间四位星号）。
    *   **只读限制**：界面无“编辑”、“删除”、“新增”按钮，仅提供Select查询权限。
3.  **血缘关系（可选高阶功能）**：
    *   展示某个标签是由哪张原始表的哪个字段计算而来的，方便排查数据问题。

---

## 4. 详细数据逻辑举例

为了确保开发人员理解，需提供具体的标签逻辑示例（电子产品行业）：

### 4.1 客户维 (Customer)
| 标签ID  | 标签名       | 类型 | 逻辑说明/SQL逻辑                           | 更新频率 |
| :------ | :----------- | :--- | :----------------------------------------- | :------- |
| C_B_001 | 会员等级     | 基础 | CRM表直接映射 (普通/银卡/金卡)             | 实时     |
| C_S_001 | 累计消费总额 | 统计 | `SUM(order_amount)` where status='success' | T+1      |
| C_D_001 | 3C发烧友     | 衍生 | 购买品类覆盖手机、平板、穿戴设备3种以上    | T+7      |
| C_D_002 | 价格敏感度   | 衍生 | 过去购买商品中，折扣商品占比 > 70%         | T+7      |

### 4.2 商品维 (Product)
| 标签ID  | 标签名     | 类型 | 逻辑说明                           | 更新频率 |
| :------ | :--------- | :--- | :--------------------------------- | :------- |
| P_B_001 | 上市年份   | 基础 | 2023, 2024, 2025                   | 静态     |
| P_S_001 | 30天销量   | 统计 | 最近30天销售数量聚合               | T+1      |
| P_S_002 | 售后返修率 | 统计 | (返修单数 / 销售单数) * 100%       | T+1      |
| P_D_001 | 爆款指数   | 衍生 | 综合浏览量、转化率、销量的加权得分 | T+1      |

### 4.3 门店维 (Store)
| 标签ID  | 标签名   | 类型 | 逻辑说明                     | 更新频率 |
| :------ | :------- | :--- | :--------------------------- | :------- |
| S_B_001 | 店铺类型 | 基础 | 旗舰店、授权店、专柜         | 静态     |
| S_S_001 | 坪效     | 统计 | 年销售额 / 店铺面积          | 月更     |
| S_D_001 | 缺货风险 | 衍生 | 当前库存可支撑销售天数 < 7天 | T+1      |

---

## 5. 非功能性需求 (NFR)

1.  **性能要求**：
    *   **ID查询响应**：单ID画像查询需在 1秒内 返回结果。
    *   **规则试算**：涉及千万级数据量的规则筛选，试算时间不超过 10秒。
2.  **数据安全与权限**：
    *   **数据脱敏**：在UI界面查看原始数据或导出时，敏感字段（手机号、身份证、采购成本价）需进行脱敏处理。
    *   **权限隔离**：
        *   门店督导只能查看自己管辖区域的门店数据。
        *   普通运营不可查看“原始数据表”，只有数据分析师可查看。
3.  **可扩展性**：
    *   系统需支持标签的动态扩展，无需修改代码即可通过配置（SQL或脚本）增加新标签。

---

## 6. 附录：页面交互草图说明

### 6.1 首页
*   顶部导航栏：[全景画像] [规则圈选] [标签管理] [数据源视图]
*   核心区域：搜索框（Select: 客户/商品/门店），输入ID后回车。

### 6.2 规则圈选页
*   左侧：标签树（按分类折叠）。
*   中间：画布区域，拖拽标签生成逻辑块（Block）。
*   底部：操作栏（试算人数、导出ID、保存人群）。

---

**主要修改建议与下一步计划**：
建议您拿着这份PRD与技术团队（特别是后端架构师和数仓工程师）进行评审，重点确认“衍生标签”的算法实现方式以及数据仓库的查询性能是否能满足T+1或实时的需求。