# 标签审批建表及模拟数据导入说明

## 一、概述

本文档详细说明标签审批功能的数据库表结构设计、建表步骤以及模拟数据导入方法，帮助用户快速搭建标签审批功能的数据库环境。

## 二、数据库表结构设计

标签审批功能包含以下核心表：

| 表名 | 描述 | 主要功能 |
|------|------|----------|
| system_user | 系统用户表 | 存储系统用户信息，包括申请人和审批人 |
| tag_application | 标签申请表 | 记录标签申请详情 |
| approval_flow | 审批流程表 | 管理审批状态流转 |
| approval_record | 审批记录表 | 保存完整审批历史 |
| tag_definition | 标签定义表扩展 | 修改status字段以支持审批状态 |

### 1. 系统用户表(system_user)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| user_id | VARCHAR(50) | PRIMARY KEY | 用户ID |
| username | VARCHAR(50) | NOT NULL UNIQUE | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密存储） |
| real_name | VARCHAR(50) | NOT NULL | 真实姓名 |
| role | ENUM('ADMIN', 'OPERATOR', 'AUDITOR') | NOT NULL | 角色 |
| status | TINYINT(1) | DEFAULT 1 | 状态（1-启用 0-停用） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 2. 标签申请表(tag_application)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| application_id | INT | AUTO_INCREMENT PRIMARY KEY | 申请ID |
| tag_id | INT | NOT NULL | 标签ID，关联tag_definition表 |
| applicant_id | VARCHAR(50) | NOT NULL | 申请人ID，关联system_user表 |
| application_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 申请时间 |
| application_reason | TEXT | NOT NULL | 申请理由 |
| application_status | ENUM('PENDING', 'APPROVED', 'REJECTED', 'WITHDRAWN') | NOT NULL | 申请状态 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 3. 审批流程表(approval_flow)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| flow_id | INT | AUTO_INCREMENT PRIMARY KEY | 流程ID |
| application_id | INT | NOT NULL | 申请ID，关联tag_application表 |
| current_step | INT | DEFAULT 1 | 当前审批步骤 |
| total_steps | INT | DEFAULT 1 | 总审批步骤 |
| flow_status | ENUM('PENDING', 'PROCESSING', 'COMPLETED') | NOT NULL | 流程状态 |
| final_result | ENUM('APPROVED', 'REJECTED') | DEFAULT NULL | 最终结果 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 4. 审批记录表(approval_record)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| record_id | INT | AUTO_INCREMENT PRIMARY KEY | 审批记录ID |
| application_id | INT | NOT NULL | 申请ID，关联tag_application表 |
| approver_id | VARCHAR(50) | NOT NULL | 审批人ID，关联system_user表 |
| approval_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 审批时间 |
| approval_status | ENUM('PENDING', 'APPROVED', 'REJECTED') | NOT NULL | 审批状态 |
| approval_opinion | TEXT | DEFAULT NULL | 审批意见 |
| approval_order | INT | NOT NULL | 审批顺序 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

## 三、建表步骤

### 1. 执行SQL脚本

使用以下命令执行SQL脚本，创建所有表结构：

```bash
python execute_tag_approval_sql.py
```

### 2. 验证表结构

执行以下命令验证表结构是否正确创建：

```bash
python check_tag_approval_tables.py
```

## 四、模拟数据说明

### 1. 模拟数据内容

模拟数据包含以下内容：

- 6个系统用户（2个管理员、2个操作员、2个审批人）
- 8个测试标签定义
- 8个标签申请（每种状态2条）
- 8个审批流程
- 8个审批记录

### 2. 模拟数据状态

模拟数据包含四种状态：

- **待审批状态(PENDING)**：申请已提交但尚未开始审批
- **已通过状态(APPROVED)**：审批流程已完成且最终结果为通过
- **已拒绝状态(REJECTED)**：审批流程已完成且最终结果为拒绝
- **已撤回状态(WITHDRAWN)**：申请人主动撤回申请

### 3. 模拟数据保存位置

模拟数据已保存到以下位置：

1. **SQL格式**：
   ```
e:\AIcodes\Case\TagFactory\Documents\SQL\tag_approval.sql
   ```

2. **CSV格式**（保存在模拟数据目录）：
   ```
e:\AIcodes\Case\TagFactory\Documents\模拟数据\system_user.csv
   e:\AIcodes\Case\TagFactory\Documents\模拟数据\tag_definition_test.csv
   e:\AIcodes\Case\TagFactory\Documents\模拟数据\tag_application.csv
   e:\AIcodes\Case\TagFactory\Documents\模拟数据\approval_flow.csv
   e:\AIcodes\Case\TagFactory\Documents\模拟数据\approval_record.csv
   ```

## 五、模拟数据导入步骤

### 1. 方法一：使用Python脚本导入SQL格式数据

执行以下命令导入模拟数据：

```bash
python execute_tag_approval_sql.py
```

### 2. 方法二：直接执行SQL脚本

使用MySQL客户端直接执行SQL脚本：

```bash
mysql -u root -p tagfactory < e:\AIcodes\Case\TagFactory\Documents\SQL\tag_approval.sql
```

### 3. 方法三：导入CSV格式数据

使用MySQL客户端或其他数据库工具导入CSV格式数据，步骤如下：

1. 确保所有表结构已创建
2. 使用LOAD DATA INFILE命令或工具界面导入CSV文件
3. 按照以下顺序导入：
   - system_user.csv
   - tag_definition_test.csv
   - tag_application.csv
   - approval_flow.csv
   - approval_record.csv

示例LOAD DATA INFILE命令：

```sql
LOAD DATA INFILE 'e:/AIcodes/Case/TagFactory/Documents/模拟数据/system_user.csv'
INTO TABLE system_user
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
```

## 六、状态流转规则

1. 申请人提交申请 → 待审批状态
2. 审批人审批通过 → 已通过状态
3. 审批人审批拒绝 → 已拒绝状态
4. 申请人主动撤回 → 已撤回状态

## 七、简化的权限控制机制

- 允许当前登录账户执行提交和审批操作
- 支持当前账户直接点击操作完成状态切换
- 完整记录所有操作的审计日志

## 八、性能与扩展性考虑

- 设计考虑了未来功能扩展的可能性
- 审批流程设计支持单级审批模式，适合DEMO系统
- 预留了字段和表结构以支持未来多级审批功能的扩展

## 九、安全考虑

- 敏感操作记录了操作人ID和操作时间
- 状态变更保留了完整历史记录，支持审计追踪

## 十、注意事项

1. 确保MySQL数据库服务已启动
2. 确保数据库连接配置正确
3. 执行脚本前请备份原有数据
4. 模拟数据仅用于测试，生产环境请使用真实数据

## 十一、联系方式

如有任何问题，请联系系统管理员。
